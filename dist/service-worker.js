const CACHE_NAME="story-app-v1",urlsToCache=["./","./index.html","./app.bundle.js","./favicon.png"];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Cache dibuka"),Promise.all(urlsToCache.map((t=>e.add(t).catch((e=>(console.error(`Gagal cache: ${t}`,e),Promise.resolve()))))))))).catch((e=>{console.error("Gagal menyimpan cache:",e)})))})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>e!==CACHE_NAME?(console.log("Menghapus cache lama:",e),caches.delete(e)):null))))))})),self.addEventListener("fetch",(e=>{if("GET"!==e.request.method)return;const t=new URL(e.request.url);t.pathname.startsWith("/v1/")||t.hostname.includes("google-analytics")||t.hostname.includes("googleapis")||t.hostname.includes("dicoding.dev")||e.respondWith(caches.match(e.request).then((t=>{const n=fetch(e.request).then((t=>{if(t&&200===t.status){const n=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,n)})).catch((e=>console.error("Gagal update cache:",e)))}return t})).catch((()=>(console.log("Gagal fetch dari jaringan"),null)));return t||n})))})),self.addEventListener("message",(e=>{if(e.data&&"SHOW_NOTIFICATION"===e.data.type){const{title:t,options:n}=e.data.payload;e.waitUntil(self.registration.showNotification(t,n))}})),self.addEventListener("push",(e=>{const t=e.data?e.data.json():{},n=t.title||"Story berhasil dibuat",a={body:t.options?.body||"Anda telah membuat story baru",icon:"./favicon.png",badge:"./favicon.png",tag:"story-notification",renotify:!0,requireInteraction:!0,data:{url:t.url||"/"}};e.waitUntil(self.registration.showNotification(n,a))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification.data?.url||"/";e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(let n=0;n<e.length;n++){const a=e[n];if(a.url===t&&"focus"in a)return a.focus()}if(clients.openWindow)return clients.openWindow(t)})))}));