importScripts("https://storage.googleapis.com/workbox-cdn/releases/6.6.1/workbox-sw.js");const getBasePath=()=>self.location.pathname.includes("/Web-Intermediate1/")?"/Web-Intermediate1":"",basePath=getBasePath();workbox?(console.log("✅ Workbox loaded successfully"),workbox.core.skipWaiting(),workbox.core.clientsClaim(),workbox.precaching.precacheAndRoute([{url:`${basePath}/`,revision:"1"},{url:`${basePath}/index.html`,revision:"1"},{url:`${basePath}/app.bundle.js`,revision:"1"},{url:`${basePath}/app.css`,revision:"1"},{url:`${basePath}/manifest.json`,revision:"1"},{url:`${basePath}/favicon.png`,revision:"1"},{url:`${basePath}/favicon-192.png`,revision:"1"},{url:`${basePath}/favicon-512.png`,revision:"1"}]),workbox.routing.registerRoute((({url:e})=>"https://story-api.dicoding.dev"===e.origin),new workbox.strategies.NetworkFirst({cacheName:"api-cache",networkTimeoutSeconds:3,plugins:[{cacheKeyWillBeUsed:async({request:e})=>e.url,handlerDidError:async({request:e})=>{const t=new URL(e.url);return t.pathname.match(/\/stories\/[^\/]+$/)?new Response(JSON.stringify({error:!1,message:"success",story:{id:"offline-1",name:"Story Offline",description:"Story ini tersedia saat offline",photoUrl:`${basePath}/favicon-192.png`,createdAt:(new Date).toISOString(),lat:-6.2088,lon:106.8456}}),{status:200,headers:{"Content-Type":"application/json"}}):t.pathname.includes("/stories")?new Response(JSON.stringify({error:!1,message:"success",listStory:[{id:"offline-1",name:"Story Offline",description:"Story offline tersedia",photoUrl:`${basePath}/favicon-192.png`,createdAt:(new Date).toISOString(),lat:-6.2088,lon:106.8456}]}),{status:200,headers:{"Content-Type":"application/json"}}):new Response(JSON.stringify({error:!1,message:"Offline response",offline:!0}),{status:200,headers:{"Content-Type":"application/json"}})}}]})),workbox.routing.registerRoute(/\.(?:png|jpg|jpeg|svg|gif|webp)$/,new workbox.strategies.CacheFirst({cacheName:"images-cache",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:100,maxAgeSeconds:2592e3})]})),workbox.routing.registerRoute(/\.(?:css|js)$/,new workbox.strategies.StaleWhileRevalidate({cacheName:"static-resources"})),workbox.routing.registerRoute((({request:e})=>"navigate"===e.mode),new workbox.strategies.NetworkFirst({cacheName:"pages-cache",plugins:[{cacheKeyWillBeUsed:async()=>`${basePath}/index.html`,handlerDidError:async()=>caches.match(`${basePath}/index.html`)}]})),console.log("✅ Workbox routing configured")):console.error("❌ Workbox failed to load"),self.addEventListener("message",(e=>{if(e.data&&"SHOW_NOTIFICATION"===e.data.type){const{title:t,options:o}=e.data.payload;e.waitUntil(self.registration.showNotification(t,o))}})),self.addEventListener("push",(e=>{const t=e.data?e.data.json():{},o=t.title||"Story berhasil dibuat",a={body:t.options?.body||"Anda telah membuat story baru",icon:`${basePath}/favicon.png`,badge:`${basePath}/favicon.png`,tag:"story-notification",renotify:!0,requireInteraction:!0,data:{url:t.url||`${basePath}/`}};e.waitUntil(self.registration.showNotification(o,a))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification.data?.url||`${basePath}/`;e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(let o=0;o<e.length;o++){const a=e[o];if(a.url===t&&"focus"in a)return a.focus()}if(clients.openWindow)return clients.openWindow(t)})))})),self.addEventListener("install",(e=>{self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(clients.claim())}));